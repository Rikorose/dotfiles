#!/bin/bash

set -e

if [ "$#" -lt 2 ]; then
    echo "Usage: compress-pdf input-file-1 [input-file-2, input-file-3, ...] output-file.pdf"
    exit 1
fi

INPUT=${@: 1:$#-1}
OUTPUT=${@: -1}

for f in "${INPUT[@]}"; do
    if [[ ! -f $f ]]; then
        echo "File $f not found"
        exit 2
    fi
done

if [[ ${OUTPUT: -3}  != "pdf" ]]; then
    echo "output-file must be pdf, but got '$OUTPUT'."
    exit 3
fi

TMP=$(mktemp --suffix='.pdf' /tmp/compress.XXXXXXXXX)

gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/printer -dNOPAUSE \
    -dQUIET -dBATCH -sOutputFile=$TMP $INPUT
mv $TMP $OUTPUT
